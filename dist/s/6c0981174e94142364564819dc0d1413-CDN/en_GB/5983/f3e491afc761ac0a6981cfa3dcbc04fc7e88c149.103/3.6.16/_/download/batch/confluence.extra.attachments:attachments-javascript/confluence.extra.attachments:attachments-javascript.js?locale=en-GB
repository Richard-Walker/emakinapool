;try {
/* module-key = 'confluence.extra.attachments:attachments-javascript', location = 'templates/extra/attachments/scripts/attachments.js' */
AJS.$(function(f){var j=AJS.params.contextPath,i="Error retrieving attachment versions.",d=AJS.DragAndDropUtils&&AJS.DragAndDropUtils.hasXhrSupport,c=!!(navigator.userAgent.indexOf("Trident/")!=-1&&(navigator.userAgent.indexOf("rv:")!=-1||navigator.appName.indexOf("Netscape")!=-1));function a(l){var m={};l.find("input").each(function(){m[this.name]=this.value});return m}function b(m){var l=m.closest(".plugin_attachments_table_container");var n={};n.attachmentId=m.data("attachment-id");f.ajax({cache:false,data:n,dataType:"html",type:"GET",url:j+"/pages/plugins/attachments/loadattachmentversions.action",success:function(p){var o=f(p);AJS.Labels.bindOpenDialog(f(".show-labels-editor",o));var q=m.next().find(".attachment-history-wrapper");q.empty();q.append(o)},error:function(o,r,p){AJS.log("Error retrieving attachment old versions: "+p);var q=l.parent(".plugin_attachments_container");l.remove();f("div.plugin_attachments_upload_container",q).remove();q.append('<div class="attachments-old-version-error error">'+i+"</div>")}})}function g(r){var o=r.find(".vf-slide-viewer");var n=r.find(".vf-slide-loading");AJS.$(n[0]).spin({length:10,radius:10,width:5});var q={width:r.data("width"),height:r.data("height"),attachment:r.data("attachment"),attachmentId:r.data("attachment-id"),attachmentVer:r.data("attachment-ver"),pageId:r.data("page-id"),downloadPath:AJS.contextPath()+r.data("download-path"),usePathAuth:r.data("use-path-auth"),editUrl:AJS.contextPath()+OC.Util.decodeUrl(r.data("edit-url"))};q.allowEdit=r.data("allow-edit")&&q.editUrl.substring(q.editUrl.length-3)!=="pdf";var l=new OC.Slide(q);var p=new OC.SlideCache(l);var m=new OC.SlideViewerView({model:l,cache:p,el:o});r.append(m.render().el);l.waitUntilReady()}function h(m){var l=m.closest(".plugin_attachments_table_container");var n={attachmentId:m.data("attachment-id")};f.ajax({cache:false,data:n,dataType:"html",type:"GET",url:j+"/rest/attachments/1.0/details/preview",success:function(p){var o=f.trim(p)?f(p):null;var q=m.next().find(".attachment-image-preview");q.empty();q.append(o||"<span></span>");if(o.is(".vf-slide-viewer-macro")){var r=OC.initSlideViewer||g;r(o)}},error:function(o,r,p){AJS.log("Error retrieving attachment preview: "+p);var q=l.parent(".plugin_attachments_container");l.remove();f("div.plugin_attachments_upload_container",q).remove();q.append('<div class="attachments-old-version-error error">'+i+"</div>")}})}var e={getFieldSetAsParams:a,initAttachmentTable:function(l){f(".attachment-menu-bar .ajs-menu-item").unbind();f(".attachment-menu-bar").ajsMenu();f(".attachments .attachment-row .attachment-dropdown-actions .action-dropdown",l).addClass("hide-menu");f(".attachments .attachment-row .attachment-dropdown-actions .action-dropdown .aui-dd-parent .aui-dropdown",l).addClass("hidden");f(".attachments .attachment-dropdown-actions span",l).addClass("hide-icons");AJS.Labels.bindOpenDialog(f(".show-labels-editor",l));var m=this.getFieldSetAsParams(l.children("fieldset"));f(".attachments .attachment-row",l).hover(function(){var n=f(this);if(!n.is(".focused")){n.addClass("hovered")}n.find("span").toggleClass("hide-icons hide-menu",false);n.find(".attachment-dropdown-actions .action-dropdown").dropDown("Standard",{alignment:"right"});n.find("a.aui-dropdown2-trigger").show()},function(){var n=f(this);n.removeClass("hovered");var o=n.is(".focused");n.find("span").toggleClass("hide-icons",!o);n.find("a.aui-dropdown2-trigger").toggle(o)}).on("click",function(q){if(f(q.target).is("a")){return}var o=f(this).find(".attachment-summary-toggle .icon");o.toggleClass("icon-section-opened icon-section-closed");o.closest("tr").next().toggleClass("hidden");if(o.is(".icon-section-opened")){var n=o.closest("tr");var p=n.data("attachment-id");if(n.next().find(".attachment-image-preview:empty").length){h(n)}if(!l.find("tr.history-"+p).length&&n.next().find(".attachment-history-wrapper").length){b(n)}}});f(".attachments .action-trigger",l).click(function(){var n=f(this).parents("tr:first")[0].id;f(".attachments .attachment-row",l).each(function(){var o=f(this);var p=o[0].id;if(p==n){o.addClass("focused");f("span",o).removeClass("hide-icons");f("a.aui-dropdown2-trigger",o).show()}else{if(o.hasClass("focused")){o.removeClass("focused");f("span",o).addClass("hide-icons");f("a.aui-dropdown2-trigger",o).hide()}}f(".attachment-dropdown-actions .action-dropdown",o).dropDown("Standard",{alignment:"right"})})})},markFileCommentFieldModified:function(l){if(l.hasClass("blank-search")){l.removeClass("blank-search");l.val("")}},initAttachmentCommentTextFields:function(l){l.find("input[name^='comment_']").each(function(){f(this).focus(function(){e.markFileCommentFieldModified(f(this))})})},renameForms:function(){var l=self.placeFocus;if(l){self.placeFocus=function(){var m=f("div.plugin_attachments_upload_container form");m.attr("name","inlinecommentform");l();m.removeAttr("name")}}},refreshOtherAttachmentsMacroInstances:function(n,l,m){f("div.plugin_attachments_table_container > fieldset").each(function(){var r=f(this);var o=f("input[name='pageId']",r).val();if(o!=n){return}var p=f(this).clone();f("input",p).each(function(){if(!f(this).hasClass("plugin_attachments_macro_render_param")){f(this).remove()}});var q=e.getFieldSetAsParams(p);q.old=q.old||"true";f.ajax({cache:false,type:"GET",url:j+"/pages/plugins/attachments/rendermacro.action",data:q,success:function(u){var s=r.parent();var t=f(u).find("div.plugin_attachments_table_container").html();s.fadeOut("normal",function(){s.html(t);e.initAttachmentTable(s)});s.fadeIn("normal",function(){AJS.Labels.bindOpenDialog(AJS.$(".show-labels-editor",s))});if(l){l()}},error:function(){if(m){m()}}})})},initAuiMessageBar:function(){if(!f("#aui-message-bar").length){f("#com-atlassian-confluence").append('<div id="aui-message-bar"></div>')}},initUploadForm:function(p){this.initAttachmentCommentTextFields(p);this.initAuiMessageBar();var o=p.children("iframe.plugin_attachments_uploadiframe");var n=p.find("input[name='confirm']");p.find("input[name='file_0']").val("");var l;if(!d){n.after("<img src='"+j+"/images/icons/wait.gif' class='plugin_attachments_uploadwaiticon'/>");l=n.next("img.plugin_attachments_uploadwaiticon")}else{l=f("img.plugin_attachments_dropzone_uploadwaiticon")}var m=e.getFieldSetAsParams(p.parents("div.plugin_attachments_upload_container").prev("div.plugin_attachments_table_container").children("fieldset"));f(".browse-files",p.parent()).on("click",function(){var q=p.find("input[name='file_0']");q.click();q.on("change",function(){if(q.val()!=""){p.submit()}})});p.submit(function(){if(m.outputType=="preview"){return false}p.find("input[name^='comment_']").each(function(){e.markFileCommentFieldModified(f(this))});var q=this;q.target=o.attr("name");n.addClass("hidden");l.css("visibility","visible");o.get(0).processUpload=true;return true});o.load(function(){if(!this.processUpload){return}var t=this.contentWindow||this.contentDocument;t=t.document?t.document:t;var s=t.body;var r=f(s);var q=r.find("div.aui-message.error");if(q.length>0&&f.trim(q.html()).length>0){AJS.messages.error("#aui-message-bar",{body:q.html()});setTimeout(function(){f(".aui-message.error").remove()},3000);l.css("visibility","hidden");n.removeClass("hidden")}else{e.refreshOtherAttachmentsMacroInstances(m.pageId,function(){l.css("visibility","hidden");n.removeClass("hidden");location.reload()},function(){AJS.messages.error("#aui-message-bar",{body:m["i18n-notpermitted"]});setTimeout(function(){f(".aui-message.error").remove()},3000);l.css("visibility","hidden");n.removeClass("hidden")});p.find("input[name='file_0']").replaceWith(f('<input type="file" name="file_0" size="30">'));p.find("input[name^='comment_']").val("")}})},hideDropdownIcons:function(){f(".attachments .attachment-row").each(function(){var l=f(this);if(l.hasClass("focused")){l.removeClass("focused");f("span",l).addClass("hide-icons")}})}};f("body").click(function(m){var l=f(m.target);if(l.parents("td").length&&!l.parents("td").hasClass("attachment-dropdown-actions")){e.hideDropdownIcons()}});f("div.plugin_attachments_table_container").each(function(){var l=f(this);e.initAttachmentTable(l)});var k=f("li.drop-zone-text");if(f.browser.msie||c){k.find("span").text(AJS.$.trim(k.text()));f("form.plugin_attachments_uploadform").removeClass("hidden")}if(d){k.removeClass("hidden")}f("form.plugin_attachments_uploadform").each(function(){e.initUploadForm(f(this))});f(".plugin_attachments_table_container").on("click",".removeAttachmentLink",function(){if(AJS.Attachments.showRemoveAttachmentConfirmDialog){AJS.Attachments.showRemoveAttachmentConfirmDialog(this);return false}});e.renameForms();AJS.bind("attachment-macro.refresh",function(m,l){e.refreshOtherAttachmentsMacroInstances(l)})});
} catch (err) {
    if (console && console.log && console.error) {
        console.log("Error running batched script.");
        console.error(err);
    }
}

;
